import{_ as ee,u as te,l as ae,r as o,c as I,q as w,E as x,o as le,b as oe,M as ne,D as se,d as s,e as f,f as O,h as n,v as V,H as M,I as ie,g as u,w as d,F as ce,x as ue,j as re,N as de,p as ge,k as me}from"./index-10307767.js";/* empty css                                                                    */const S=p=>(ge("data-v-dee696b2"),p=p(),me(),p),pe={class:"imageModuleWrapper"},_e={class:"inoutput"},fe={class:"imageArea"},ve=["src"],he=["src"],ye={class:"labelArea"},Ie=S(()=>n("text",{style:{display:"flex","justify-content":"center",width:"80px"}},"Image:",-1)),we=S(()=>n("span",{style:{"margin-left":"5px"}},"上传图片",-1)),xe={__name:"ImageModule",setup(p){const v=te(),k=ae("$bus");k.on("outputImage",E),k.on("photo",z);const g=o("/imgs/Lena.png"),_=o([]),r=o(!0),h=o(!1),R=o(),A=o(null),j=o(null),b=o(null),N=o(null),C=o(de);let i,c;const D=I(()=>v.getters.worker),y=I(()=>v.getters.processConfigs),U=I(()=>y.value.map((t,a)=>({title:t.title,index:t.index,selected:t.selected,imageAvailable:t.imageAvailable,params:t.params.map(l=>l.paramValue)})));async function E(){_.value.length=0,await w();try{F()}catch(e){console.log(e),x({message:e,grouping:!0,type:"error"})}}function z(){console.log("photo");const e=document.getElementById("imageOutput").toDataURL(),t=document.createElement("a");t.href=e,t.download="output.png",t.style.display="none",document.body.appendChild(t),t.click()}function B(){let e=document.getElementById("imageOutput");e.width=i,e.height=c;let t=e.getContext("2d");t.clearRect(0,0,i,c);let a=document.getElementById("imageInput");t.drawImage(a,0,0);let l=t.getImageData(0,0,i,c);return _.value.push(e.toDataURL()),l}const F=async()=>{let e=B();await w(),D.value.postMessage({image:e,paramsList:U.value,type:"image"})};function $(){D.value.onmessage=function(e){r.value=!1,console.log(e.data.type),e.data.type=="processError"?e.data.indexs.map(l=>{y.value[l].selected=!1,x({message:`${U.value[l].title}发生错误.`,grouping:!0,type:"error"})}):e.data.type=="error"&&(console.log("error",e.data.indexs),e.data.indexs.map(l=>{y.value[l].selected=!1}),x({message:"something went wrong",grouping:!0,type:"error",duration:1e3}));let t=document.getElementById("imageOutput");t.width=i,t.height=c;let a=t.getContext("2d");a.clearRect(0,0,i,c),a.putImageData(e.data.image,0,0),_.value.push(t.toDataURL())}}function W(){let e=document.getElementById("imageInput");i=e.width,c=e.height}function H(){r.value=!0}function T(){b.value.click()}function q(e){const t=e.target.files[0];if(t){let a=URL.createObjectURL(t);C.value.push({name:t.name,value:a}),g.value=a,r.value=!0}}function G(){r.value||(console.log("click"),h.value=!0)}function J(){h.value=!1}return le(async()=>{console.log("image onMounted"),v.dispatch("set_currentOption","image"),await w();let e=document.getElementById("imageInput");i=e.clientWidth,c=e.clientHeight,e.onload=()=>{W(),B()},$()}),oe(async()=>{console.log("image Activated")}),ne(()=>{console.log("image Deactivated")}),se(()=>{console.log("image onUnmounted")}),(e,t)=>{const a=s("el-image-viewer"),l=s("UploadFilled"),K=s("el-icon"),P=s("el-option"),Q=s("el-select"),L=s("el-col"),X=s("el-button"),Y=s("el-row");return f(),O("div",pe,[n("div",_e,[n("div",fe,[n("img",{id:"imageInput",ref_key:"imageInput",ref:j,src:g.value,style:{display:"none"}},null,8,ve),n("img",{id:"imageSrc",src:g.value,style:V({display:r.value?"flex":"none"})},null,12,he),h.value?(f(),M(a,{key:0,src:A.value,"url-list":_.value,fit:"contain",ref_key:"elImage",ref:R,infinite:!1,"hide-on-click-modal":"",onClose:J},null,8,["src","url-list"])):ie("",!0),n("canvas",{ref_key:"imageOutput",ref:N,id:"imageOutput",style:V({display:r.value?"none":"flex"}),onClick:G},null,4)]),n("div",ye,[u(Y,{justify:"center",align:"middle",gutter:20,style:{width:"100%"}},{default:d(()=>[u(L,{span:12,class:"labelItem"},{default:d(()=>[Ie,u(Q,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=m=>g.value=m),placeholder:"选择图片",size:"large",onChange:H},{default:d(()=>[n("li",{class:"el-select-dropdown__item",onClick:T},[u(K,null,{default:d(()=>[u(l)]),_:1}),we]),(f(!0),O(ce,null,ue(C.value,(m,Z)=>(f(),M(P,{label:m.name,value:m.value,key:Z},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n("input",{type:"file",ref_key:"fileInput",ref:b,style:{display:"none"},onChange:q},null,544)]),_:1}),u(L,{span:12,class:"labelItem"},{default:d(()=>[u(X,{size:"large",onClick:t[1]||(t[1]=m=>E(!1))},{default:d(()=>[re(" Image Output")]),_:1})]),_:1})]),_:1})])])])}}},Ce=ee(xe,[["__scopeId","data-v-dee696b2"]]);export{Ce as default};
